-----------------------------------------------------------------
-- SQL Code Generation
-- Entity: Reviews
-- Item: spUpdateReview
-- Generated: 11/20/2024, 2:52:33 PM
--
-- This was generated by the MemberJunction CodeGen tool.
-- This file should NOT be edited by hand.
-----------------------------------------------------------------

------------------------------------------------------------
----- UPDATE PROCEDURE FOR Review
------------------------------------------------------------
DROP PROCEDURE IF EXISTS [abstracts].[spUpdateReview]
GO

CREATE PROCEDURE [abstracts].[spUpdateReview]
    @ID int,
    @AssignedAt datetime,
    @SubmissionID int,
    @ReviewerID int,
    @RoleID uniqueidentifier,
    @Score int,
    @Status nvarchar(50),
    @ReviewedAt datetime,
    @Comments nvarchar(MAX)
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [abstracts].[Review]
    SET
        [AssignedAt] = @AssignedAt,
        [SubmissionID] = @SubmissionID,
        [ReviewerID] = @ReviewerID,
        [RoleID] = @RoleID,
        [Score] = @Score,
        [Status] = @Status,
        [ReviewedAt] = @ReviewedAt,
        [Comments] = @Comments
    WHERE
        [ID] = @ID

    -- return the updated record so the caller can see the updated values and any calculated fields
    SELECT
                                        *
                                    FROM
                                        [abstracts].[vwReviews]
                                    WHERE
                                        [ID] = @ID
                                    
END
GO

GRANT EXECUTE ON [abstracts].[spUpdateReview] TO [cdp_Developer], [cdp_Integration]
GO

------------------------------------------------------------
----- TRIGGER FOR __mj_UpdatedAt field for the Review table
------------------------------------------------------------
DROP TRIGGER IF EXISTS [abstracts].trgUpdateReview
GO
CREATE TRIGGER [abstracts].trgUpdateReview
ON [abstracts].[Review]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;
    UPDATE
        [abstracts].[Review]
    SET
        __mj_UpdatedAt = GETUTCDATE()
    FROM
        [abstracts].[Review] AS _organicTable
    INNER JOIN
        INSERTED AS I ON
        _organicTable.[ID] = I.[ID];
END;
GO
        